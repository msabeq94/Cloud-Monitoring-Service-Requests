{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.29.47.4906",
      "templateHash": "8502321035802536731"
    }
  },
  "parameters": {
    "allAlertaScope": {
      "type": "string",
      "defaultValue": "VF-01"
    },
    "newActionGroupId": {
      "type": "string",
      "defaultValue": "/subscriptions/24b4b7e2-6a4a-4418-8868-9f51dfeca509/resourceGroups/vf-core-IT-resources-rg/providers/microsoft.insights/actiongroups/vf-core-cm-notifications"
    },
    "subscriptionId": {
      "type": "string",
      "defaultValue": "[subscription().subscriptionId]"
    },
    "alertProcessingRuleScope": {
      "type": "string",
      "defaultValue": "[format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), parameters('allAlertaScope'))]"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-vm-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "microsoft.compute/virtualmachines"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Compute/virtualMachines/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-vm-powerOff",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "microsoft.compute/virtualmachines"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Compute/virtualMachines/powerOff/action"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-resource-group-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "A resource Group has been Deleted from Azure subscriptions",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "microsoft.resources/subscriptions/resourcegroups"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Resources/subscriptions/resourceGroups/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-resource-group-created",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "A resource Group has been created in the Azure subscriptions",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "microsoft.resources/subscriptions/resourcegroups"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Resources/subscriptions/resourceGroups/write"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-application-gw-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Application Gateway has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "microsoft.network/applicationgateways"
            },
            {
              "field": "operationName",
              "equals": "microsoft.network/applicationgateways/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-application-gw-stopped",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Application Gateway has been Stopped",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "microsoft.network/applicationgateways"
            },
            {
              "field": "operationName",
              "equals": "microsoft.network/applicationgateways/stop/action"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-load-balancer-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "Load Balancer has been Deleted ",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Network/loadBalancers"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Network/loadBalancers/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-virtual-network-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "A Virtual Network has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Network/virtualNetworks"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Network/virtualNetworks/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-MySQL-flexible-server-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Azure MySQL Flexible Server Database has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.DBForMySQL/servers"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.DBForMySQL/servers/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-MySQL-flexible-server-failover",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Azure MySQL Flexible Server Database has Failed",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.DBForMySQL/servers"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.DBForMySQL/servers/stop/action"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-PostgreSQL-flexible-server-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Azure PostgreSQL Flexible Server Database has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.DBForPostgreSQL/servers"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.DBForPostgreSQL/servers/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-SQL-server-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Azure SQL Database has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Sql/servers/databases"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Sql/servers/databases/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-SQL-server-issue-failover",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "An Azure SQL Database has failed.",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Sql/servers/databases"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Sql/servers/databases/failover/action"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-storage-account-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "A Storage Account has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Storage/storageAccounts"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Storage/storageAccounts/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-storage-account-failover",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "Storage Account failover occurred",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Storage/storageAccounts"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Storage/storageAccounts/failover/action"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    },
    {
      "type": "Microsoft.Insights/activityLogAlerts",
      "apiVersion": "2020-10-01",
      "name": "vf-core-cm-network-security-group-deleted",
      "location": "global",
      "tags": {
        "DeployedBy": "Vodafone",
        "VodafoneBuildVersion": "vf-build-v1",
        "VodafoneProduct": "Cloud Monitoring"
      },
      "properties": {
        "description": "Network Security Group has been Deleted",
        "scopes": [
          "[parameters('alertProcessingRuleScope')]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "category",
              "equals": "Administrative"
            },
            {
              "field": "resourceType",
              "equals": "Microsoft.Network/networkSecurityGroups"
            },
            {
              "field": "operationName",
              "equals": "Microsoft.Network/networkSecurityGroups/delete"
            }
          ]
        },
        "actions": {
          "actionGroups": [
            {
              "actionGroupId": "[parameters('newActionGroupId')]",
              "webhookProperties": {}
            }
          ]
        },
        "enabled": true
      }
    }
  ]
}